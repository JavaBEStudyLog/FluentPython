# CHAPTER 10 ì¼ê¸‰ í•¨ìˆ˜ ë””ìì¸ íŒ¨í„´

> ë””ìì¸ íŒ¨í„´ : ì¼ë°˜ì ì¸ ì„¤ê³„ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ì¢…í•©ì ì¸ ë ˆì‹œí”¼

í´ë˜ìŠ¤ê°€ í•˜ëŠ” ì¼ì„ ê°€ë…ì„±ì´ ë” ì¢‹ê³  ê°„ê²°í•˜ê²Œ í•¨ìˆ˜ë¡œ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì£¼ê³ ì í•¨

í•¨ìˆ˜ë¥¼ ê°ì²´ë¡œ ì‚¬ìš©í•˜ê³ , íŒì— ë°•íŒ ì½”ë“œë¥¼ ì œê±°í•´ ì „ëµ íŒ¨í„´ì˜ êµ¬í˜„ì„ ë¦¬íŒ©í„°ë§

## 10.1 ì´ë²ˆ ì¥ì˜ ë³€ê²½ ì‚¬í•­

- 10.2.5ì ˆ 'ë°ì»¤ë ˆì´í„°ë¡œ ê°œì„ í•œ ì „ëµíŒ¨í„´'
  - ë“±ë¡ ë°ì»¤ë ˆì´í„°ë¥¼ í™œìš©í•˜ê³ ì í•¨
  - ì˜ˆì œì—ì„œ ìë£Œí˜• íŒíŠ¸ë„ ì‚¬ìš©

## 10.2 ì‚¬ë¡€ ì—°êµ¬ : ë¦¬íŒ©í„°ë§ ì „ëµ

#### ì „ëµ íŒ¨í„´

- ì•Œê³ ë¦¬ì¦˜ì„ ìº¡ìˆ í™”í•´ì„œ ì„œë¡œ êµí™˜ ê°€ëŠ¥í•˜ê²Œ ë§Œë“œëŠ” ë””ìì¸ íŒ¨í„´
- íŒŒì´ì¬ì—ì„œ í•¨ìˆ˜ë¥¼ ì¼ê¸‰ ê°ì²´ë¡œ ì‚¬ìš©í•˜ë©´ ë” ê°„ë‹¨íˆ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ë””ìì¸ íŒ¨í„´ì˜ ì¢‹ì€ ì‚¬ë¡€
- ì¼ë ¨ì˜ ì•Œê³ ë¦¬ì¦˜ì„ ì •ì˜í•˜ê³  ê°ê°ì„ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ ì•ˆì— ë„£ì–´ì„œ êµì²´í•˜ê¸° ì‰½ê²Œ ë§Œë“¦
- ì „ëµì„ ì´ìš©í•˜ë©´ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ë”°ë¼ ì•Œê³ ë¦¬ì¦˜ì„ ë…ë¦½ì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŒ
- ì–´ë–¤ ê¸°ëŠ¥ì„ ì—¬ëŸ¬ ê°€ì§€ ì „ëµìœ¼ë¡œ êµ¬í˜„í•´ë‘ê³ , ëŸ°íƒ€ì„ì— ì–´ë–¤ ì „ëµì„ ì“¸ì§€ ê²°ì •í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¦

### 10.2.1 ê³ ì „ì ì¸ ì „ëµ

- í´ë˜ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì „ëµì„ ìº¡ìˆ í™”
- ì „í†µì ì¸ OOP ìŠ¤íƒ€ì¼, ëª…í™•í•œ êµ¬ì¡°ë¥¼ ê°€ì§

```python
class Promotion:
    def discount(self, order):
        return 0

class FidelityPromo(Promotion):
    def discount(self, order):
        return order.total() * 0.05 if order.customer.fidelity >= 1000 else 0

class BulkItemPromo(Promotion):
    def discount(self, order):
        return sum(item.total() * 0.1 for item in order.cart if item.quantity >= 20)
# ê° ì „ëµì„ ë³„ë„ í´ë˜ìŠ¤ë¡œ ì •ì˜
# ê³µí†µ ì¸í„°í˜ì´ìŠ¤(discount) êµ¬í˜„í•´ì„œ ì‚¬ìš©
# ì „ëµ ê°ì²´ë¥¼ ìƒì„±í•´ì„œ Orderì— ì „ë‹¬

class Order:
    def __init__(self, customer, cart, promotion=None):
        self.customer = customer
        self.cart = list(cart)
        self.promotion = promotion  # ì „ëµ ê°ì²´ ì£¼ì…
    def total(self):
        return sum(item.total() for item in self.cart)
    def due(self):
        discount = self.promotion.discount(self) if self.promotion else 0
        return self.total() - discount
```

- ì „ëµë§ˆë‹¤ í´ë˜ìŠ¤ ì •ì˜ê°€ í•„ìš” -> ì½”ë“œê°€ ê¸¸ì–´ì§€ê³  ë°˜ë³µë¨

### 10.2.2 í•¨ìˆ˜ ì§€í–¥ ì „ëµ

- ì „ëµì„ í•¨ìˆ˜ë¡œ í‘œí˜„
- ì¼ê¸‰ í•¨ìˆ˜ í™œìš©

```python
def fidelity_promo(order):
    return order.total() * 0.05 if order.customer.fidelity >= 1000 else 0

def bulk_item_promo(order):
    return sum(item.total() * 0.1 for item in order.cart if item.quantity >= 20)
# ì „ëµì„ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ í•¨ìˆ˜ë¡œ ì‘ì„±
# discount() ë©”ì„œë“œ ëŒ€ì‹ , ë‹¨ìˆœíˆ orderë¥¼ ì¸ìë¡œ ë°›ëŠ” ì¼ê¸‰ í•¨ìˆ˜ ì‚¬ìš©

class Order:
    def __init__(self, customer, cart, promotion=None):
        self.customer = customer
        self.cart = list(cart)
        self.promotion = promotion  # í•¨ìˆ˜ ì „ë‹¬ ê°€ëŠ¥
    def total(self):
        return sum(item.total() for item in self.cart)
    def due(self):
        discount = self.promotion(self) if self.promotion else 0
        return self.total() - discount
```

- ì½”ë“œê°€ ê°„ê²°í•˜ê³  ìœ ì—°í•´ì§
- íŒŒì´ì¬ì˜ ì¼ê¸‰ ê°ì²´ íŠ¹ì„±ì„ ì‚´ë ¤, ê°„ë‹¨í•œ ì „ëµì„ ë°”ë¡œ ì •ì˜ê°€ ê°€ëŠ¥í•¨

### 10.2.3 ìµœì„ ì˜ ì „ëµ ì„ íƒí•˜ê¸° : ë‹¨ìˆœí•œ ì ‘ê·¼ë²•

- ì „ëµ ì¤‘ ê°€ì¥ ìœ ë¦¬í•œ ê²ƒì„ ì„ íƒ
- ì „ëµ ëª©ë¡ì„ ìˆœíšŒí•˜ë©´ì„œ ìµœëŒ“ê°’ ë“± ì„ íƒ

```python
promos = [fidelity_promo, bulk_item_promo]
# ì—¬ëŸ¬ ì „ëµì„ í•œêº¼ë²ˆì— ë¦¬ìŠ¤íŠ¸ë¡œ ê´€ë¦¬

def best_promo(order):
    return max(promo(order) for promo in promos)
# í•˜ë‚˜ë§Œ ê³¨ë¼ì•¼í•œë‹¤ë©´, ìµœëŒ€ í• ì¸ì•¡ì„ ê³„ì‚°í•´ì„œ ì ìš©

# ì‚¬ìš© ì‹œ
order = Order(customer, cart, promotion=best_promo)
```

- í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œ ì „ëµì„ ì§ì ‘ ê³ ë¥´ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ìµœì ì˜ ì „ëµì„ ì„ íƒí•  ìˆ˜ ìˆê²Œ ë¨
- ë¡œì§ì˜ ì „ëµ ê²°ì • ì±…ì„ì„ Orderê°€ ì•„ë‹Œ í•¨ìˆ˜(best_promo)ì— ìœ„ì„í•¨

### 10.2.4 ëª¨ë“ˆì—ì„œ ì „ëµ ì°¾ê¸°

- globals() ë“±ìœ¼ë¡œ ì „ëµ ìë™ ìˆ˜ì§‘
- ë°˜ë³µì„ ì¤„ì´ê³  ìë™í™”í•¨

```python
# ì „ëµ í•¨ìˆ˜ë“¤ì´ globals() ì•ˆì— ìˆë‹¤ë©´
promos = [func for name, func in globals().items()
          if name.endswith('_promo') and name != 'best_promo']
# promos ë¦¬ìŠ¤íŠ¸ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì„±
# í•¨ìˆ˜ëª…ì„ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë§í•´ì„œ ë°˜ë³µì—†ì´ ì „ëµ ì¶”ê°€ ê°€ëŠ¥
```

- ì „ëµì´ ëŠ˜ì–´ë‚˜ë„ promos(ì—¬ëŸ¬ ì „ëµì„ ë‹´ì€ ë¦¬ìŠ¤íŠ¸)ë¥¼ ì§ì ‘ ìˆ˜ì •í•  í•„ìš” ì—†ìŒ
- ìë™í™”ëœ ì „ëµ ìˆ˜ì§‘ì´ ê°€ëŠ¥í•´ ìœ ì§€ë³´ìˆ˜ ìš©ì´

### 10.2.5 ë°ì»¤ë ˆì´í„°ë¡œ ê°œì„ í•œ ì „ëµ íŒ¨í„´

- ë°ì»¤ë ˆì´í„°ë¡œ ì „ëµì„ ë“±ë¡
- í™•ì¥ì„±ì´ ë†’ê³ , ì„ ì–¸ì  ë°©ì‹, ê¹”ë”í•œ ì½”ë“œê°€ íŠ¹ì§•

```python
promos = []

def promotion(promo_func):
    promos.append(promo_func)
    return promo_func

@promotion
def fidelity_promo(order):
    ...

@promotion
def bulk_item_promo(order):
    ...
# ì „ëµ í•¨ìˆ˜ë¥¼ ì‘ì„±í• ë•Œë§ˆë‹¤ ë°ì»¤ë ˆì´í„°ë¡œ ìë™ ë“±ë¡ -> ìˆ˜ë™ ë¦¬ìŠ¤íŠ¸ êµ¬ì„± ì—†ì´ ëª…ì‹œì ì´ê³  ì„ ì–¸ì ì¸ ë°©ì‹ìœ¼ë¡œ ì „ëµ ê´€ë¦¬

def best_promo(order):
    return max(promo(order) for promo in promos)

```

- ì „ëµ ë“±ë¡ì„ ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬ ê°€ëŠ¥
- ì–´ë–¤ ì „ëµì„ ì„ì‹œë¡œ ë¹„í™œì„±í™” í•˜ê³  ì‹¶ë‹¤ë©´ ë°ì»¤ë ˆì´í„°ë§Œ ì£¼ì„ ì²˜ë¦¬í•˜ë©´ ë¨
- ê¹”ë”í•˜ê³  ëª¨ë“ˆí™”ëœ ì½”ë“œ ì‘ì„± ê°€ëŠ¥

## 10.3 ëª…ë ¹ íŒ¨í„´

í•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì„ ì´ìš©í•´ êµ¬í˜„

ì—°ì‚°ì„ ì‹¤í–‰í•˜ëŠ” ê°ì²´(í˜¸ì¶œì)ì™€ ì—°ì‚°ì„ êµ¬í˜„í•˜ëŠ” ê°ì²´(ìˆ˜ì‹ ì)ë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ëª©ì 

- ìš”ì²­ì„ ê°ì²´ë¡œ ì¶”ìƒí™”í•´ì„œ ì‹¤í–‰ì„ ë‚˜ì¤‘ìœ¼ë¡œ ë¯¸ë£¨ê±°ë‚˜, ë¡œê·¸ë¡œ ë‚¨ê¸°ê±°ë‚˜, ì—¬ëŸ¬ ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•¨
- í˜¸ì¶œìëŠ” ëª…ë ¹ì„ ì‹¤í–‰ë§Œ í•˜ê³ , ìˆ˜ì‹ ìê°€ ì§„ì§œ ë¡œì§ì„ ìˆ˜í–‰

#### ê¸°ë³¸ ê°œë…

- ëª…ë ¹ ê°ì²´ë¥¼ ìˆ˜ì‹ ìì™€ í˜¸ì¶œì ì‚¬ì´ì— ë†“ê³ , ëª…ë ¹ì€ execute()ë¼ëŠ” ë‹¨ í•˜ë‚˜ì˜ ë©”ì„œë“œë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜
- execute()ëŠ” ì›í•˜ëŠ” ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë ¤ê³  ìˆ˜ì‹ ìê°€ êµ¬í˜„í•œ ë©”ì„œë“œë¥¼ í˜¸ì¶œ
- => í˜¸ì¶œìëŠ” ìˆ˜ì‹ ìì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì•Œ í•„ìš”ê°€ ì—†ê³ , ëª…ë ¹ì˜ ì„œë¸Œí´ë˜ìŠ¤ë¥¼ í†µí•´ ì„œë¡œ ë‹¤ë¥¸ ìˆ˜ì‹ ìë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŒ
- í˜¸ì¶œìëŠ” êµ¬ì²´ì ì¸ ëª…ë ¹ìœ¼ë¡œ ì„¤ì •ë˜ë©°, ì—°ì‚°ì„ ì‹¤í–‰í•˜ë ¤ê³  execute() ë©”ì„œë“œë¥¼ í˜¸ì¶œ

#### ì˜ˆì œ (ì¥ë°”êµ¬ë‹ˆ ëª…ë ¹ ì‹œìŠ¤í…œ)

```python
# ìˆ˜ì‹ ì : ì‹¤ì œë¡œ ì—…ë¬´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê°ì²´
class Cart:
    def __init__(self):
        self.items = []
    def add(self, item):
        print(f"ğŸ›’ {item} ì¶”ê°€")
        self.items.append(item)
    def remove(self, item):
        print(f"âŒ {item} ì œê±°")
        self.items.remove(item)
    def apply_discount(self, percent):
        print(f"ğŸ’¸ {percent}% í• ì¸ ì ìš©")

# ëª…ë ¹ í´ë˜ìŠ¤ : ëª¨ë“  ëª…ë ¹ì€ execute() ë©”ì„œë“œë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í•¨
# ë‚´ë¶€ì— ìˆ˜ì‹ ì ê°ì²¼ë¥´ ì°¸ì¡°í•˜ê³  ìˆê³ , execute()ì•ˆì—ì„œ ìˆ˜ì‹ ìì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œ
class Command:
    def execute(self):
        raise NotImplementedError

class AddItemCommand(Command):
    def __init__(self, cart, item):
        self.cart = cart
        self.item = item
    def execute(self):
        self.cart.add(self.item)

class RemoveItemCommand(Command):
    def __init__(self, cart, item):
        self.cart = cart
        self.item = item
    def execute(self):
        self.cart.remove(self.item)

class DiscountCommand(Command):
    def __init__(self, cart, percent):
        self.cart = cart
        self.percent = percent
    def execute(self):
        self.cart.apply_discount(self.percent)

# í˜¸ì¶œì : ëª…ë ¹ì„ ì‹¤í–‰í•  íƒ€ì´ë°ë§Œ ì•Œê³  ìˆëŠ” ê°ì²´
# ëª…ë ¹ ê°ì²´ì˜ execute()ë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ ë‚´ë¶€ ë¡œì§ì€ ëª¨ë¦„
class MacroCommand:
    def __init__(self):
        self.commands = []
    def add_command(self, command):
        self.commands.append(command)
    def run(self):
        for command in self.commands:
            command.execute()

# í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ
cart = Cart()

macro = MacroCommand()
macro.add_command(AddItemCommand(cart, "Python ì±…"))
macro.add_command(AddItemCommand(cart, "ë…¸íŠ¸ë¶"))
macro.add_command(RemoveItemCommand(cart, "Python ì±…"))
macro.add_command(DiscountCommand(cart, 10))

macro.run()
# ğŸ›’ Python ì±… ì¶”ê°€
# ğŸ›’ ë…¸íŠ¸ë¶ ì¶”ê°€
# âŒ Python ì±… ì œê±°
# ğŸ’¸ 10% í• ì¸ ì ìš©
```

- ìš”ì²­ì„ ê°ì²´ë¡œ ì¶”ìƒí™”í•˜ë¯€ë¡œ í, ìŠ¤íƒ, ì·¨ì†Œ/ë‹¤ì‹œ ì‹¤í–‰ ê°™ì€ ê¸°ëŠ¥ êµ¬í˜„ì´ ì‰¬ì›Œì§
- í˜¸ì¶œìì™€ ìˆ˜ì‹ ì ì‚¬ì´ë¥¼ ì™„ì „íˆ ë¶„ë¦¬
- ëª…ë ¹ë“¤ì„ ì €ì¥í•˜ê±°ë‚˜ ì¬ì‚¬ìš©í•˜ê±°ë‚˜ í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€

## 10.4 ìš”ì•½
